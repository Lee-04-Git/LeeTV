import React, { useState, useEffect, useRef } from "react";
import {
  View,
  Text,
  TouchableOpacity,
  StyleSheet,
  StatusBar,
  ScrollView,
  Image,
  Dimensions,
  ActivityIndicator,
  Pressable,
  LayoutAnimation,
  Platform,
  UIManager,
} from "react-native";
import { LinearGradient } from "expo-linear-gradient";
import { SafeAreaView } from "react-native-safe-area-context";
import { Ionicons } from "@expo/vector-icons";
import colors from "../constants/colors";
import {
  StarIcon,
  PlayIcon,
  BackIcon,
} from "../components/Icons";
import {
  fetchMovieDetails,
  fetchTVShowDetails,
  fetchSeasonDetails,
  fetchSimilarMovies,
  fetchRecommendedMovies,
  fetchSimilarTVShows,
  fetchRecommendedTVShows,
} from "../services/tmdbApi";
import {
  addToList as addToSupabaseList,
  removeFromList as removeFromSupabaseList,
  isInList as checkIsInList,
} from "../services/supabaseService";
import { getEpisodeProgress, getMovieProgress } from "../services/vidrockService";

// Enable LayoutAnimation on Android
if (Platform.OS === 'android' && UIManager.setLayoutAnimationEnabledExperimental) {
  UIManager.setLayoutAnimationEnabledExperimental(true);
}

const { width } = Dimensions.get("window");

// Episode Card Component with expandable description
const EpisodeCard = ({ episode, seasonNumber, showTitle, showId, posterPath, backdropPath, navigation, formatEpisodeCode }) => {
  const [isExpanded, setIsExpanded] = useState(false);
  const [showSeeMore, setShowSeeMore] = useState(false);
  const [episodeProgress, setEpisodeProgress] = useState(null);
  
  const description = episode.overview || "No description available.";
  
  // Check if episode has aired yet
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const airDate = episode.airDate ? new Date(episode.airDate) : null;
  const hasAired = airDate ? airDate <= today : true; // Assume aired if no date
  
  // Format release date if not aired
  const releaseText = airDate && !hasAired 
    ? airDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
    : null;

  // Load episode progress
  useEffect(() => {
    const loadProgress = async () => {
      if (hasAired) {
        const progress = await getEpisodeProgress(showId, seasonNumber, episode.episodeNumber);
        setEpisodeProgress(progress);
      }
    };
    loadProgress();
  }, [showId, seasonNumber, episode.episodeNumber, hasAired]);

  const handleLongPress = () => {
    LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
    setIsExpanded(!isExpanded);
  };

  const handleSeeMore = () => {
    LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);
    setIsExpanded(true);
  };

  const handlePress = () => {
    if (!hasAired) return; // Don't navigate if episode hasn't aired
    navigation.navigate("VideoPlayer", {
      title: showTitle,
      mediaId: showId,
      mediaType: "tv",
      season: seasonNumber,
      episode: episode.episodeNumber,
      episodeTitle: episode.name,
      poster_path: posterPath,
      backdrop_path: backdropPath,
    });
  };

  const onTextLayout = (e) => {
    // Check if text was truncated (more than 2 lines worth)
    if (e.nativeEvent.lines && e.nativeEvent.lines.length >= 2) {
      setShowSeeMore(true);
    }
  };

  return (
    <Pressable
      style={styles.episodeCard}
      onPress={handlePress}
      onLongPress={handleLongPress}
      delayLongPress={300}
      android_ripple={{ color: 'rgba(255,255,255,0.1)' }}
    >
      {/* Thumbnail with Play Icon or Coming Soon Badge */}
      <View style={styles.episodeThumbnailWrapper}>
        <Image
          source={{ uri: episode.stillPath }}
          style={[styles.episodeThumbnail, !hasAired && styles.episodeThumbnailDimmed]}
          resizeMode="cover"
        />
        {hasAired ? (
          <View style={styles.episodePlayIcon}>
            <Ionicons name="play" size={16} color={colors.white} />
          </View>
        ) : (
          <View style={styles.episodeComingSoonBadge}>
            <Ionicons name="time-outline" size={12} color="#fff" />
            <Text style={styles.episodeComingSoonText}>Coming</Text>
          </View>
        )}
        {episode.runtime && episode.runtime !== "N/A" && hasAired && (
          <Text style={styles.episodeDuration}>{episode.runtime}</Text>
        )}
        {/* Progress Bar */}
        {episodeProgress && episodeProgress.progress_percent > 0 && (
          <View style={styles.episodeProgressBarContainer}>
            <View style={[styles.episodeProgressBar, { width: `${episodeProgress.progress_percent}%` }]} />
          </View>
        )}
      </View>

      {/* Episode Details */}
      <View style={styles.episodeDetails}>
        <View style={styles.episodeTitleRow}>
          <Text style={styles.episodeTitle} numberOfLines={1}>
            {formatEpisodeCode(seasonNumber, episode.episodeNumber)} Â· {episode.name}
          </Text>
        </View>
        
        {/* Not out yet indicator with release date */}
        {!hasAired && releaseText && (
          <View style={styles.episodeReleaseBadge}>
            <Ionicons name="calendar-outline" size={12} color="#37d1e4" />
            <Text style={styles.episodeReleaseText}>Available {releaseText}</Text>
          </View>
        )}
        
        {/* Description with See More */}
        <View style={styles.episodeDescriptionContainer}>
          <Text 
            style={styles.episodeDescription} 
            numberOfLines={isExpanded ? undefined : 2}
            onTextLayout={!isExpanded ? onTextLayout : undefined}
          >
            {description}
          </Text>
          {!isExpanded && showSeeMore && description.length > 80 && (
            <TouchableOpacity onPress={handleSeeMore} style={styles.seeMoreButton}>
              <Text style={styles.seeMoreText}>...See More</Text>
            </TouchableOpacity>
          )}
          {isExpanded && (
            <TouchableOpacity onPress={handleLongPress} style={styles.seeLessButton}>
              <Text style={styles.seeLessText}>See Less</Text>
            </TouchableOpacity>
          )}
        </View>
      </View>
    </Pressable>
  );
};

const ShowDetailsScreen = ({ navigation, route }) => {
  const { show: initialShow } = route.params || {};
  const [show, setShow] = useState(initialShow);
  const [loading, setLoading] = useState(true);
  const [selectedSeason, setSelectedSeason] = useState(1);
  const [seasonDetails, setSeasonDetails] = useState(null);
  const [loadingEpisodes, setLoadingEpisodes] = useState(false);
  const [relatedContent, setRelatedContent] = useState([]);
  const [loadingRelated, setLoadingRelated] = useState(false);
  const [inList, setInList] = useState(false);
  const [checkingList, setCheckingList] = useState(true);
  const [movieProgress, setMovieProgress] = useState(null);

  const seasonTabsRef = useRef(null);

  const handleSeasonSelect = (seasonNumber, index) => {
    setSelectedSeason(seasonNumber);

    // Calculate scroll position to center the selected tab
    const TAB_WIDTH = 90; // width of each season link
    const screenWidth = width;
    const scrollX = Math.max(0, (index * TAB_WIDTH) - (screenWidth / 2) + (TAB_WIDTH / 2));

    // Animate the scroll
    seasonTabsRef.current?.scrollTo({ x: scrollX, animated: true });
  };

  // Format episode code as SXXEXX
  const formatEpisodeCode = (season, episode) => {
    const s = String(season).padStart(2, '0');
    const e = String(episode).padStart(2, '0');
    return `S${s}E${e}`;
  };

  useEffect(() => {
    loadDetails();
  }, [initialShow?.id]);

  useEffect(() => {
    checkListStatus();
  }, [initialShow?.id, show?.id, show?.type]);

  useEffect(() => {
    if (show?.type === "tv" && show?.id) {
      loadSeasonDetails(selectedSeason);
    }
  }, [selectedSeason, show?.id]);

  useEffect(() => {
    if (show?.id && show?.type) {
      loadRelatedContent();
    }
  }, [show?.id, show?.type]);

  // Load movie progress
  useEffect(() => {
    const loadMovieProgress = async () => {
      if (show?.type === "movie" && show?.id) {
        const progress = await getMovieProgress(show.id);
        setMovieProgress(progress);
      }
    };
    loadMovieProgress();
  }, [show?.id, show?.type]);

  const checkListStatus = async () => {
    const mediaType =
      show?.type ||
      initialShow?.type ||
      show?.media_type ||
      initialShow?.media_type;
    const mediaId = show?.id || initialShow?.id;

    if (!mediaId || !mediaType) return;

    try {
      setCheckingList(true);
      const status = await checkIsInList(mediaId, mediaType);
      setInList(status);
    } catch (error) {
      console.error("Error checking list status:", error);
    } finally {
      setCheckingList(false);
    }
  };

  const handleListToggle = async () => {
    if (!show) return;

    const mediaType = show.type || show.media_type || "movie";

    try {
      if (inList) {
        await removeFromSupabaseList(show.id, mediaType);
        setInList(false);
      } else {
        const mediaToAdd = {
          ...show,
          type: mediaType,
          media_type: mediaType,
        };
        await addToSupabaseList(mediaToAdd);
        setInList(true);
      }
    } catch (error) {
      console.error("Error toggling list:", error);
    }
  };

  const loadDetails = async () => {
    if (!initialShow?.id) return;

    try {
      setLoading(true);
      let details;

      if (initialShow.type === "movie") {
        details = await fetchMovieDetails(initialShow.id);
      } else if (initialShow.type === "tv") {
        details = await fetchTVShowDetails(initialShow.id);
      }

      if (details) {
        setShow(details);
        if (details.type === "tv" && details.seasons?.length > 0) {
          const firstRealSeason = details.seasons.find(
            (s) => s.seasonNumber > 0
          );
          if (firstRealSeason) {
            setSelectedSeason(firstRealSeason.seasonNumber);
          }
        }
      }
    } catch (error) {
      console.error("Error loading details:", error);
    } finally {
      setLoading(false);
    }
  };

  const loadSeasonDetails = async (seasonNumber) => {
    if (!show?.id || show?.type !== "tv") return;

    try {
      setLoadingEpisodes(true);
      const details = await fetchSeasonDetails(show.id, seasonNumber);
      setSeasonDetails(details);
    } catch (error) {
      console.error("Error loading season details:", error);
    } finally {
      setLoadingEpisodes(false);
    }
  };

  const loadRelatedContent = async () => {
    if (!show?.id || !show?.type) return;

    try {
      setLoadingRelated(true);
      let similarContent = [];
      let recommendedContent = [];

      if (show.type === "movie") {
        // Fetch both similar and recommended movies
        const [similar, recommended] = await Promise.all([
          fetchSimilarMovies(show.id),
          fetchRecommendedMovies(show.id),
        ]);
        similarContent = similar;
        recommendedContent = recommended;
      } else if (show.type === "tv") {
        // Fetch both similar and recommended TV shows
        const [similar, recommended] = await Promise.all([
          fetchSimilarTVShows(show.id),
          fetchRecommendedTVShows(show.id),
        ]);
        similarContent = similar;
        recommendedContent = recommended;
      }

      // Combine and deduplicate results
      const combined = [...similarContent, ...recommendedContent];
      const uniqueMap = new Map();
      combined.forEach((item) => {
        if (!uniqueMap.has(item.id)) {
          uniqueMap.set(item.id, item);
        }
      });

      const uniqueResults = Array.from(uniqueMap.values()).slice(0, 12);
      setRelatedContent(uniqueResults);
    } catch (error) {
      console.error("Error loading related content:", error);
    } finally {
      setLoadingRelated(false);
    }
  };

  return (
    <SafeAreaView style={styles.container} edges={["top"]}>
      <StatusBar barStyle="light-content" />

      {/* Header with back button */}
      <View style={styles.header}>
        <TouchableOpacity
          onPress={() => navigation.goBack()}
          style={styles.backButton}
        >
          <BackIcon size={24} color={colors.white} />
        </TouchableOpacity>
        <View style={styles.headerSpacer} />
      </View>

      <ScrollView
        style={styles.content}
        showsVerticalScrollIndicator={false}
      >
        {loading ? (
          <View style={styles.loadingContainer}>
            <ActivityIndicator size="large" color={colors.netflixRed} />
            <Text style={styles.loadingText}>Loading details...</Text>
          </View>
        ) : (
          <>
            {/* Featured Image/Banner */}
            <View style={styles.bannerContainer}>
              <Image
                source={{ uri: show?.backdrop || show?.image }}
                style={styles.bannerImage}
                resizeMode="cover"
              />
              <LinearGradient
                colors={["transparent", "rgba(0,0,0,0.5)", colors.background]}
                style={styles.bannerGradient}
              />
              {/* Movie Progress Bar */}
              {show?.type === "movie" && movieProgress && movieProgress.progress_percent > 0 && (
                <View style={styles.movieProgressBarContainer}>
                  <View style={[styles.movieProgressBar, { width: `${movieProgress.progress_percent}%` }]} />
                </View>
              )}
            </View>

            {/* Show Info */}
            <View style={styles.infoContainer}>
              <Text style={styles.title}>{show?.title}</Text>

              {/* Action Buttons */}
              <View style={styles.actionButtonsRow}>
                {show?.type === "movie" && (
                  <TouchableOpacity
                    style={styles.playButtonMain}
                    onPress={() => {
                      navigation.navigate("VideoPlayer", {
                        title: show?.title,
                        mediaId: show?.id,
                        mediaType: "movie",
                        poster_path: show?.poster_path,
                        backdrop_path: show?.backdrop_path,
                      });
                    }}
                  >
                    <PlayIcon size={24} color={colors.black} />
                    <Text style={styles.playButtonMainText}>Play</Text>
                  </TouchableOpacity>
                )}

                <TouchableOpacity
                  style={styles.myListButton}
                  onPress={handleListToggle}
                  disabled={checkingList}
                >
                  <Ionicons
                    name={inList ? "checkmark" : "add"}
                    size={24}
                    color="#fff"
                  />
                  <Text style={styles.myListButtonText}>
                    {inList ? "Added" : "My List"}
                  </Text>
                </TouchableOpacity>
              </View>

              {/* Meta Information */}
              <View style={styles.metaRow}>
                <View style={styles.ratingBadge}>
                  <StarIcon size={16} color="#FFD700" />
                  <Text style={styles.ratingText}>{show?.rating}</Text>
                </View>
                <Text style={styles.metaText}>{show?.year}</Text>
                {show?.type === "movie" && show?.runtime && (
                  <Text style={styles.metaText}>{show.runtime}</Text>
                )}
                {show?.type === "tv" && (
                  <Text style={styles.metaText}>
                    {show?.numberOfSeasons} Season
                    {show?.numberOfSeasons !== 1 ? "s" : ""}
                  </Text>
                )}
              </View>

              {/* Genres */}
              {show?.genres && show.genres.length > 0 && (
                <View style={styles.genresRow}>
                  {show.genres.slice(0, 3).map((genre, index) => (
                    <View key={index} style={styles.genreBadge}>
                      <Text style={styles.genreText}>{genre}</Text>
                    </View>
                  ))}
                </View>
              )}

              {/* Description */}
              <Text style={styles.description}>{show?.overview}</Text>

              {/* Cast */}
              {show?.cast && show.cast.length > 0 && (
                <View style={styles.castSection}>
                  <Text style={styles.sectionTitle}>Cast</Text>
                  <ScrollView
                    horizontal
                    showsHorizontalScrollIndicator={false}
                    contentContainerStyle={styles.castRow}
                  >
                    {show.cast.slice(0, 10).map((actor, index) => (
                      <View key={index} style={styles.castCard}>
                        <Image
                          source={{
                            uri:
                              actor.profile ||
                              "https://via.placeholder.com/100x100?text=No+Image",
                          }}
                          style={styles.castImage}
                        />
                        <Text style={styles.castName} numberOfLines={2}>
                          {actor.name}
                        </Text>
                        {actor.character && (
                          <Text style={styles.castCharacter} numberOfLines={1}>
                            {actor.character}
                          </Text>
                        )}
                      </View>
                    ))}
                  </ScrollView>
                </View>
              )}

              {/* Creator/Director */}
              {show?.type === "tv" && show?.creator && (
                <Text style={styles.creatorText}>Creator: {show.creator}</Text>
              )}
              {show?.type === "movie" && show?.director && (
                <Text style={styles.creatorText}>
                  Director: {show.director}
                </Text>
              )}

              {/* TV Show Seasons & Episodes */}
              {show?.type === "tv" &&
                show?.seasons &&
                show.seasons.length > 0 && (
                  <>
                    {/* Season Links - Scroll Style */}
                    <ScrollView
                      ref={seasonTabsRef}
                      horizontal
                      showsHorizontalScrollIndicator={false}
                      contentContainerStyle={styles.seasonLinksContainer}
                      style={styles.seasonLinksScroll}
                    >
                      {show.seasons
                        .filter((s) => s.seasonNumber > 0)
                        .map((season, index) => (
                          <TouchableOpacity
                            key={season.id}
                            style={styles.seasonLink}
                            onPress={() => handleSeasonSelect(season.seasonNumber, index)}
                            activeOpacity={0.7}
                          >
                            <Text
                              style={[
                                styles.seasonLinkText,
                                selectedSeason === season.seasonNumber &&
                                styles.seasonLinkTextActive,
                              ]}
                            >
                              Season {season.seasonNumber}
                            </Text>
                            {selectedSeason === season.seasonNumber && (
                              <View style={styles.seasonLinkUnderline} />
                            )}
                          </TouchableOpacity>
                        ))}
                    </ScrollView>

                    {/* Episodes List - Netflix Style Vertical List */}
                    {loadingEpisodes ? (
                      <View style={styles.episodesLoadingContainer}>
                        <ActivityIndicator
                          size="small"
                          color={colors.white}
                        />
                        <Text style={styles.episodesLoadingText}>
                          Loading episodes...
                        </Text>
                      </View>
                    ) : (
                      <View style={styles.episodesList}>
                        {seasonDetails?.episodes?.map((episode) => (
                          <EpisodeCard
                            key={episode.id}
                            episode={episode}
                            seasonNumber={selectedSeason}
                            showTitle={show?.title}
                            showId={show?.id}
                            posterPath={show?.poster_path}
                            backdropPath={show?.backdrop_path}
                            navigation={navigation}
                            formatEpisodeCode={formatEpisodeCode}
                          />
                        ))}
                      </View>
                    )}
                  </>
                )}

              {/* More Like This Section */}
              {relatedContent.length > 0 && (
                <View style={styles.moreLikeThisSection}>
                  <Text style={styles.moreLikeThisTitle}>More Like This</Text>
                  <ScrollView
                    horizontal
                    showsHorizontalScrollIndicator={false}
                    contentContainerStyle={styles.relatedList}
                  >
                    {relatedContent.map((item) => (
                      <TouchableOpacity
                        key={item.id}
                        style={styles.relatedCard}
                        onPress={() => {
                          navigation.push("ShowDetails", { show: item });
                        }}
                      >
                        <Image
                          source={{ uri: item.image }}
                          style={styles.relatedImage}
                          resizeMode="cover"
                        />
                        <View style={styles.relatedOverlay}>
                          <Text style={styles.relatedTitle} numberOfLines={2}>
                            {item.title}
                          </Text>
                          <View style={styles.relatedRating}>
                            <StarIcon size={10} color="#FFD700" />
                            <Text style={styles.relatedRatingText}>
                              {item.rating}
                            </Text>
                          </View>
                        </View>
                      </TouchableOpacity>
                    ))}
                  </ScrollView>
                </View>
              )}
            </View>
          </>
        )}
      </ScrollView >
    </SafeAreaView >
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: colors.background,
  },
  header: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 20,
    paddingVertical: 12,
    position: "absolute",
    top: 0,
    left: 0,
    right: 0,
    zIndex: 10,
    backgroundColor:
      "linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%)",
  },
  backButton: {
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: "rgba(0, 0, 0, 0.5)",
    justifyContent: "center",
    alignItems: "center",
  },
  logo: {
    fontSize: 22,
    fontWeight: "bold",
    color: colors.netflixRed,
    letterSpacing: 3,
    textShadow: "0px 2px 8px rgba(0, 0, 0, 0.6)",
  },
  headerSpacer: {
    width: 38,
  },
  content: {
    flex: 1,
  },
  bannerContainer: {
    width: width,
    height: width * 0.6,
    position: "relative",
  },
  bannerImage: {
    width: "100%",
    height: "100%",
  },
  bannerGradient: {
    ...StyleSheet.absoluteFillObject,
  },
  movieProgressBarContainer: {
    position: "absolute",
    bottom: 0,
    left: 0,
    right: 0,
    height: 4,
    backgroundColor: "rgba(255, 255, 255, 0.3)",
  },
  movieProgressBar: {
    height: "100%",
    backgroundColor: "#37d1e4",
  },
  infoContainer: {
    paddingHorizontal: 20,
    paddingTop: 20,
    paddingBottom: 30,
    marginTop: -60,
  },
  title: {
    fontSize: 28,
    fontWeight: "bold",
    color: colors.white,
    marginBottom: 20,
    letterSpacing: 0.3,
    lineHeight: 34,
  },
  actionButtonsRow: {
    flexDirection: "row",
    gap: 12,
    marginBottom: 20,
  },
  playButtonMain: {
    flex: 1,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: colors.white,
    paddingVertical: 12,
    paddingHorizontal: 20,
    borderRadius: 6,
    gap: 8,
  },
  playButtonMainText: {
    color: colors.black,
    fontSize: 16,
    fontWeight: "bold",
  },
  myListButton: {
    flex: 1,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    backgroundColor: "rgba(255, 255, 255, 0.2)",
    paddingVertical: 12,
    paddingHorizontal: 20,
    borderRadius: 6,
    gap: 8,
  },
  myListButtonText: {
    color: colors.white,
    fontSize: 16,
    fontWeight: "bold",
  },
  ratingContainer: {
    flexDirection: "row",
    marginBottom: 18,
    gap: 6,
  },
  description: {
    color: colors.lightGray,
    fontSize: 15,
    lineHeight: 22,
    marginBottom: 24,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    paddingVertical: 100,
  },
  loadingText: {
    color: colors.white,
    fontSize: 16,
    marginTop: 16,
    fontWeight: "600",
  },
  bannerGradient: {
    ...StyleSheet.absoluteFillObject,
  },
  playButtonText: {
    color: colors.black,
    fontSize: 16,
    fontWeight: "bold",
    marginLeft: 8,
  },
  metaRow: {
    flexDirection: "row",
    alignItems: "center",
    gap: 10,
    marginBottom: 12,
    flexWrap: "wrap",
  },
  ratingBadge: {
    flexDirection: "row",
    alignItems: "center",
    backgroundColor: "rgba(255, 215, 0, 0.15)",
    paddingHorizontal: 10,
    paddingVertical: 5,
    borderRadius: 4,
    gap: 5,
  },
  ratingText: {
    color: "#FFD700",
    fontSize: 14,
    fontWeight: "bold",
  },
  metaText: {
    color: colors.lightGray,
    fontSize: 15,
    fontWeight: "500",
  },
  genresRow: {
    flexDirection: "row",
    flexWrap: "wrap",
    gap: 8,
    marginBottom: 18,
  },
  genreBadge: {
    backgroundColor: "rgba(255, 255, 255, 0.15)",
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 4,
    borderWidth: 1,
    borderColor: "rgba(255, 255, 255, 0.2)",
  },
  genreText: {
    color: colors.white,
    fontSize: 13,
    fontWeight: "600",
  },
  castSection: {
    marginTop: 8,
    marginBottom: 20,
  },
  sectionTitle: {
    color: colors.white,
    fontSize: 17,
    fontWeight: "bold",
    marginBottom: 12,
  },
  castRow: {
    paddingRight: 20,
    alignItems: "flex-start",
  },
  castCard: {
    alignItems: "center",
    marginRight: 14,
    width: 75,
  },
  castImage: {
    width: 65,
    height: 65,
    borderRadius: 32.5,
    backgroundColor: "rgba(255, 255, 255, 0.1)",
    marginBottom: 8,
    borderWidth: 2,
    borderColor: "rgba(255, 255, 255, 0.15)",
  },
  castName: {
    color: colors.white,
    fontSize: 11,
    fontWeight: "600",
    textAlign: "center",
    lineHeight: 14,
    height: 28,
  },
  castCharacter: {
    color: colors.gray,
    fontSize: 10,
    textAlign: "center",
    marginTop: 2,
    height: 14,
  },
  creatorText: {
    color: colors.lightGray,
    fontSize: 14,
    marginTop: 8,
    marginBottom: 24,
    lineHeight: 20,
  },
  // Season Links - Scroll Style
  seasonLinksScroll: {
    marginTop: 20,
    marginBottom: 16,
    marginHorizontal: -20,
  },
  seasonLinksContainer: {
    paddingHorizontal: 20,
    gap: 24,
  },
  seasonLink: {
    paddingVertical: 8,
    alignItems: "center",
  },
  seasonLinkText: {
    color: colors.gray,
    fontSize: 15,
    fontWeight: "500",
  },
  seasonLinkTextActive: {
    color: colors.white,
    fontWeight: "700",
  },
  seasonLinkUnderline: {
    position: "absolute",
    bottom: 0,
    left: 0,
    right: 0,
    height: 2,
    backgroundColor: colors.white,
    borderRadius: 1,
  },
  // Episodes Loading
  episodesLoadingContainer: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "center",
    paddingVertical: 40,
    gap: 12,
  },
  episodesLoadingText: {
    color: colors.gray,
    fontSize: 14,
  },
  // Episodes List - Netflix Style Vertical
  episodesList: {
    gap: 0,
  },
  // Episode Card - Netflix Style (horizontal layout: thumbnail left, info right)
  episodeCard: {
    flexDirection: "row",
    alignItems: "flex-start",
    paddingVertical: 12,
    borderBottomWidth: 1,
    borderBottomColor: "rgba(255, 255, 255, 0.1)",
  },
  episodeThumbnailWrapper: {
    position: "relative",
    width: 130,
    height: 73,
    borderRadius: 4,
    overflow: "hidden",
    backgroundColor: "rgba(255, 255, 255, 0.1)",
  },
  episodeThumbnail: {
    width: "100%",
    height: "100%",
  },
  episodePlayIcon: {
    position: "absolute",
    top: "50%",
    left: "50%",
    marginTop: -14,
    marginLeft: -14,
    width: 28,
    height: 28,
    borderRadius: 14,
    backgroundColor: "rgba(0, 0, 0, 0.7)",
    borderWidth: 1,
    borderColor: colors.white,
    justifyContent: "center",
    alignItems: "center",
  },
  episodeDuration: {
    position: "absolute",
    bottom: 4,
    right: 4,
    color: colors.white,
    fontSize: 10,
    fontWeight: "600",
    backgroundColor: "rgba(0, 0, 0, 0.8)",
    paddingHorizontal: 4,
    paddingVertical: 2,
    borderRadius: 2,
  },
  episodeProgressBarContainer: {
    position: "absolute",
    bottom: 0,
    left: 0,
    right: 0,
    height: 3,
    backgroundColor: "rgba(255, 255, 255, 0.3)",
  },
  episodeProgressBar: {
    height: "100%",
    backgroundColor: "#37d1e4",
  },
  episodeDetails: {
    flex: 1,
    marginLeft: 12,
  },
  episodeTitleRow: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
  },
  episodeTitle: {
    color: colors.white,
    fontSize: 14,
    fontWeight: "600",
    marginBottom: 4,
    flex: 1,
  },
  episodeDescriptionContainer: {
    position: "relative",
  },
  episodeDescription: {
    color: colors.gray,
    fontSize: 12,
    lineHeight: 18,
  },
  episodeThumbnailDimmed: {
    opacity: 0.5,
  },
  episodeComingSoonBadge: {
    position: "absolute",
    top: "50%",
    left: "50%",
    marginTop: -12,
    marginLeft: -28,
    flexDirection: "row",
    alignItems: "center",
    backgroundColor: "rgba(0, 0, 0, 0.85)",
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 4,
    gap: 4,
  },
  episodeComingSoonText: {
    color: "#fff",
    fontSize: 10,
    fontWeight: "600",
  },
  episodeReleaseBadge: {
    flexDirection: "row",
    alignItems: "center",
    gap: 4,
    marginBottom: 4,
    marginTop: 2,
  },
  episodeReleaseText: {
    color: "#37d1e4",
    fontSize: 11,
    fontWeight: "500",
  },
  seeMoreButton: {
    marginTop: 2,
  },
  seeMoreText: {
    color: colors.lightGray,
    fontSize: 12,
    fontWeight: "500",
  },
  seeLessButton: {
    marginTop: 6,
  },
  seeLessText: {
    color: colors.lightGray,
    fontSize: 12,
    fontWeight: "500",
  },
  moreLikeThisSection: {
    marginTop: 30,
    marginBottom: 20,
  },
  moreLikeThisTitle: {
    color: colors.white,
    fontSize: 20,
    fontWeight: "bold",
    marginBottom: 16,
    letterSpacing: 0.5,
  },
  relatedList: {
    paddingRight: 20,
  },
  relatedCard: {
    marginRight: 10,
    borderRadius: 6,
    overflow: "hidden",
    position: "relative",
  },
  relatedImage: {
    width: 110,
    height: 150,
    borderRadius: 6,
  },
  relatedOverlay: {
    position: "absolute",
    bottom: 0,
    left: 0,
    right: 0,
    backgroundColor: "rgba(0, 0, 0, 0.75)",
    padding: 8,
  },
  relatedTitle: {
    color: colors.white,
    fontSize: 12,
    fontWeight: "600",
    marginBottom: 4,
  },
  relatedRating: {
    flexDirection: "row",
    alignItems: "center",
    gap: 4,
  },
  relatedRatingText: {
    color: colors.lightGray,
    fontSize: 11,
    fontWeight: "600",
  },
});

export default ShowDetailsScreen;
